Q1)
WITH type_stats AS (
    SELECT 
        ad_type,
        SUM(duration_seconds) AS total_duration,
        AVG(duration_seconds) AS avg_duration
    FROM advertisements
    GROUP BY ad_type
),
overall AS (
    SELECT SUM(duration_seconds) AS grand_total
    FROM advertisements
)
SELECT 
    t.ad_type,
    t.total_duration,
    t.avg_duration,
    ROUND((t.total_duration / o.grand_total) * 100, 2) AS percentage_contribution
FROM type_stats t
CROSS JOIN overall o
ORDER BY t.total_duration DESC;

Q2)
SELECT 
    a.ad_id,
    a.client_name,
    a.ad_type,
    a.duration_seconds,
    a.release_date
FROM advertisements a
JOIN (
    SELECT 
        ad_type,
        AVG(duration_seconds) AS avg_duration
    FROM advertisements
    GROUP BY ad_type
) t
ON a.ad_type = t.ad_type
WHERE a.duration_seconds > t.avg_duration
ORDER BY a.ad_type, a.duration_seconds DESC;

Q3)
SELECT 
  ad_id,
  client_name,
  ad_type,
  duration_seconds,
  RANK() OVER (PARTITION BY ad_type 
  ORDER BY duration_seconds DESC) 
  AS duration_rank

FROM advertisements;

